<!DOCTYPE html>
<html lang="en">
  <head>
      <% include ./partials/head %>  

      <script>
        
        //activate filter and checks which one is being activated
        async function activatefilter(filterType)
        { 
          if(filterType == "produce")
          {
          var filter = document.getElementById('produce_filter').value;
          if(filter == "All"){
            window.location = '/app/order'}
            else if (filter)
            { window.location = '/app/order/filter/produce/'+ filter;}
          } 
          if(filterType == "province")
          {
          var filter = document.getElementById('province_filter').value;
          if(filter == "All"){
            window.location = '/app/order'}
            else if (filter)
            { window.location = '/app/order/filter/province/'+ filter;}
          }
          if(filterType == "timeframe")
          {
          var filter = document.getElementById('timeframe_filter').value;
          if(filter == "All"){
            window.location = '/app/order'}
            else if (filter)
            { window.location = '/app/order/filter/timeframe/'+ filter;}
          } 
        }
          
        
  
        //checks current active filter when rendering
        async function filterCheck(filter,filterType)
        { console.log(filter);
          console.log(filterType)
          if(filterType == "produce"){
                if( filter == "All")
                {
                  document.getElementById('produce_filter').value = "All";
                }
                if( filter == "Baby Marrow")
                {
                  document.getElementById('produce_filter').value = "Baby Marrow";
                }
                if( filter == "Baby Leeks")
                {
                  document.getElementById('produce_filter').value = "Baby Leeks";
                }
                if( filter == "Basil")
                {
                  document.getElementById('produce_filter').value = "Basil";
                }
                if( filter == "Beetroot")
                {
                  document.getElementById('produce_filter').value = "Beetroot";
                }
                if( filter == "Bergamot")
                {
                  document.getElementById('produce_filter').value = "Bergamot";
                }
                if( filter == "Blood Oranges")
                {
                  document.getElementById('produce_filter').value = "Blood Oranges";
                }
                if( filter == "Cabbage")
                {
                  document.getElementById('produce_filter').value = "Cabbage";
                }
                if( filter == "Carrots")
                {
                  document.getElementById('produce_filter').value = "Carrots";
                }
                if( filter == "Cauliflower")
                {
                  document.getElementById('produce_filter').value = "Cauliflower";
                }
                if( filter == "Cayenne Pepper")
                {
                  document.getElementById('produce_filter').value = "Cayenne Pepper";
                }
                if( filter == "Cucumber")
                {
                  document.getElementById('produce_filter').value = "Cucumber";
                }
                if( filter == "Eggs")
                {
                  document.getElementById('produce_filter').value = "Eggs";
                }
                if( filter == "Fennel")
                {
                  document.getElementById('produce_filter').value = "Fennel";
                }
                if( filter == "Granadilla")
                {
                  document.getElementById('produce_filter').value = "Granadilla";
                }
                if( filter == "Green Beans")
                {
                  document.getElementById('produce_filter').value = "Green Beans";
                }
                if( filter == "Herbs")
                {
                  document.getElementById('produce_filter').value = "Herbs";
                }
                if( filter == "Lebanese Cucumber")
                {
                  document.getElementById('produce_filter').value = "Lebanese Cucumber";
                }
                if( filter == "Leeks")
                {
                  document.getElementById('produce_filter').value = "Leeks";
                }
                if( filter == "Lemon")
                {
                  document.getElementById('produce_filter').value = "Lemon";
                }
                if( filter == "Lettuce")
                {
                  document.getElementById('produce_filter').value = "Lettuce";
                }
                if( filter == "Limes")
                {
                  document.getElementById('produce_filter').value = "Limes";
                }
                if( filter == "Mor")
                {
                  document.getElementById('produce_filter').value = "Mor";
                }
                if( filter == "Onion")
                {
                  document.getElementById('produce_filter').value = "Onion";
                }
                if( filter == "Pak Choi")
                {
                  document.getElementById('produce_filter').value = "Pak Choi";
                }
                if( filter == "Parsley")
                {
                  document.getElementById('produce_filter').value = "Parsley";
                }
                if( filter == "Radish")
                {
                  document.getElementById('produce_filter').value = "Radish";
                }
                if( filter == "Sorrel")
                {
                  document.getElementById('produce_filter').value = "Sorrel";
                }
                if( filter == "Swiss Chard")
                {
                  document.getElementById('produce_filter').value = "Swiss Chard";
                }
                if( filter == "Spinach")
                {
                  document.getElementById('produce_filter').value = "Spinach";
                }
                if( filter == "Turnips")
                {
                  document.getElementById('produce_filter').value = "Turnips";
                }

          }
          else if(filterType == "province"){
                if( filter == "All")
                {
                  document.getElementById('province_filter').value = "All";
                }
                if( filter == "Western Cape")
                {
                  document.getElementById('province_filter').value = "Western Cape";
                }
                if( filter == "Eastern Cape")
                {
                  document.getElementById('province_filter').value = "Eastern Cape";
                }
                if( filter == "Northern Cape")
                {
                  document.getElementById('province_filter').value = "Northern Cape";
                }
                if( filter == "North West")
                {
                  document.getElementById('province_filter').value = "North West";
                }
                if( filter == "KZN")
                {
                  document.getElementById('province_filter').value = "KZN";
                }
                if( filter == "Free State")
                {
                  document.getElementById('province_filter').value = "Free State";
                }
                if( filter == "Gauteng")
                {
                  document.getElementById('province_filter').value = "Gauteng";
                }
                if( filter == "Mpumalanga")
                {
                  document.getElementById('province_filter').value = "Mpumalanga";
                }
                if( filter == "Limpopo")
                {
                  document.getElementById('province_filter').value = "Limpopo";
                }
          }
          else if(filterType == "timeframe"){
              if( filter == "All")
                {
                  document.getElementById('timeframe_filter').value = "All";
                }
                if( filter == "1 Week")
                {
                  document.getElementById('timeframe_filter').value = "1-Week";
                }
                if( filter == "1 Month")
                {
                  document.getElementById('timeframe_filter').value = "1-Month";
                }
                if( filter == "6 Months")
                {
                  document.getElementById('timeframe_filter').value = "6-Month";
                }
                if( filter == "1 Year")
                {
                  document.getElementById('timeframe_filter').value = "1-Year";
                }
          }
          else if( filter == "")
          {
          }
          else
          {//default
            console.log("Unexpected Filter received");
            window.location = '/app/order'
          }

        }
           </script>

  </head>
  <body onload="filterCheck('<%=filter_data%>','<%=filter_type%>')">
   <!-- START: header -->

  <div class="probootstrap-loader"></div>

  <header role="banner" class="probootstrap-header">
      <% include ./partials/header %>
  </header>
  <!-- END: header -->

   <!-- START TABLE-->
   <div class="container" style="width: 100%;">
    <h3>Order Dashboard</h3>

    <% include ./partials/notificationbar %>

    <!--FILTERS SECTION-->
    <div class="row">
    <div class="col-12 col-lg-12 col-xl-12">
          <div class="col-12 col-lg-12 col-xl-12">
            <h4>Filters</h4>
          </div>
        <div class="col-4 col-lg-4 col-xl-4">
          <p>Produce Type</p>
          <select class="custom-select d-block w-100 " name="produce_filter" id="produce_filter" required onchange="activatefilter('produce')">
            <option value="" selected disabled>Select Produce Type</option>
            <option>All</option>
        <option>Baby Marrow</option>
        <option>Baby Leeks</option>
        <option>Basil</option>
        <option>Beetroot</option>
        <option>Bergamot</option>
        <option>Blood Oranges</option>
        <option>Cabbage</option>
        <option>Carrots</option>
        <option>Cauliflower</option>
        <option>Cayenne Pepper</option>
        <option>Cucumber</option>
        <option>Eggs</option>
        <option>Fennel</option>
        <option>Granadilla</option>
        <option>Green Beans</option>
        <option>Herbs</option>
        <option>Lebanese Cucumber</option>
        <option>Leeks</option>
        <option>Lemon</option>
        <option>Lettuce</option>
        <option>Limes</option>
        <option>Mor</option>
        <option>Onion</option>
        <option>Pak Choi</option>
        <option>Parsley</option>
        <option>Radish</option>
        <option>Sorrel</option>
        <option>Swiss Chard</option>
        <option>Spinach</option>
        <option>Turnips</option>
          </select>
        </div>
        <div class="col-4 col-lg-4 col-xl-4">
          <p>Province:</p>
          <select class="custom-select d-block w-100 " name="province_filter" id="province_filter" required onchange="activatefilter('province')">
            <option value="" selected disabled>Select a Province</option>
            <option>All</option>
            <option>Western Cape</option>
            <option>Eastern Cape</option>
            <option>Northern Cape</option>
            <option>North West</option>
            <option>KZN</option>
            <option>Free State</option>
            <option>Gauteng</option>
            <option>Mpumalanga</option>
            <option>Limpopo</option>
          </select>
        </div>
        <div class="col-4 col-lg-4 col-xl-4">
          <p>Date Filter:</p>
          <select class="custom-select d-block w-100 " name="timeframe_filter" id="timeframe_filter" required onchange="activatefilter('timeframe')">
            <option value="" selected disabled>Select a timeframe</option>
            <option>All</option>
            <option>1-Week</option>
            <option>1-Month</option>
            <option>6-Month</option>
            <option>1-Year</option>
          </select>
        </div>
      </div>
    </div>
    
<!--OFFERS AND BIDS SECTIONS-->
<div class="col-12 col-lg-12 col-xl-12">
  <% if(bid_rows.length || offer_rows.length) {

    for(var i = 0; i< produce_rows.length; i++){
  %>
  <div class="row" style="border-bottom-style: solid;">
      <!--PRODUCE HEADING-->
      <div class="col-2 col-lg-2 col-xl-2">
        <h4><%=produce_rows[i]%></h4>
      </div>
      <!--BIDS COL-->
      <div class="col-5 col-lg-5 col-xl-5" >
        <h4>BIDS</h4>
        <!--Each card-->
        <% for(var k = 0; k< bid_rows.length; k++){ 
            if(bid_rows[k].bid_produceName == produce_rows[i]) {
          %>
        <div class="card col-1 col-lg-1 col-xl-1" style="width: 12rem;background-color: white;border-radius: 5px;margin: 10px;padding: 5px;">
          <div class="card-header">
            Bid
          </div>
          <div class="card-body">
            <h5 class="card-title"><%=bid_rows[k].bid_produceName%></h5>
            <p class="card-text">
              User: <%=bid_rows[k].bid_user%> <br>
              Quantity: <%=bid_rows[k].bid_quantity%>kgs <br>
              Price: <%=bid_rows[k].bid_price%>                            
            </p>
            <a href="#" class="btn-sm btn-primary">Accept</a>
            <a href="#" class="btn-sm btn-info">Compare</a>
          </div>
        </div>
        <%}} %>
      </div>
      <!--OFFERS COL-->
      <div class="col-5 col-lg-5 col-xl-5">
       <h4>OFFERS</h4>
         <!--Each card-->
         <% for(var k = 0; k< offer_rows.length; k++){ 
          if(offer_rows[k].offer_produceName == produce_rows[i]) {
        %>
      <div class="card col-1 col-lg-1 col-xl-1" style="width: 12rem;background-color: white;border-radius: 5px;margin: 10px;padding: 5px;">
        <div class="card-header">
          Offer
        </div>
        <div class="card-body">
          <h5 class="card-title"><%=offer_rows[k].offer_produceName%></h5>
          <p class="card-text">
            User: <%=offer_rows[k].offer_user%> <br>
            Quantity: <%=offer_rows[k].offer_quantity%>kgs <br>
            Price: <%=offer_rows[k].offer_price%>                            
          </p>
          <a href="#" class="btn-sm btn-primary">Accept</a>
          <a href="#" class="btn-sm btn-info">Compare</a>
        </div>
      </div>
      <%}} %>
      </div>
</div>

<!--END OF OFFER SECTION-->
<% }

           }else{ %>
               
                <div class="col-12 col-lg-12 col-xl-12"> 
                  <h3>No Biddings or Offers available at the moment</h3>
                </div>
              
            <% } %>
</div>


     
   </div>
   <!--END of offers section-->

    <!-- start footer -->
    <% include ./partials/footer %>
    <!-- end footer -->
    
   <!--<script type="text/javascript" src="/js/bundle.js"></script>-->
    <script src="/js/scripts.min.js"></script>
  <script src="/js/main.min.js"></script>
  <script src="/js/custom.js"></script>
  </body>
</html>
